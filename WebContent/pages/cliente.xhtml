<ui:composition template="/WEB-INF/templates/principal.xhtml"
  xmlns="http://www.w3.org/1999/xhtml"
  xmlns:h="http://java.sun.com/jsf/html"
  xmlns:f="http://java.sun.com/jsf/core" 
  xmlns:ui="http://java.sun.com/jsf/facelets"
  xmlns:p="http://primefaces.org/ui">

<ui:define name="pagina-titulo">Cadastro de Cliente</ui:define>

  <ui:define name="corpo-pagina">
  
  	<style type="text/css">
  		#tabela-form-endereco td{
  			border: 0;
  			padding: 0 3px 0 0;
  		}
  	</style>
  	
  	<ui:param name="pagina-titulo" value="Cadastro de Cliente" />
  	
	<h:form id="form-geral">
		<!-- INICIO DA DECLARAÇÃO DAS ABAS -->	
		<p:tabView id="tab">
		
			<!-- ABA DE DADOS PESSOAIS -->
		    <p:tab id="tab-dados-pessoais" title="Dados Pessoais">  
		        <h:panelGrid columns="2">		          
		            <h:outputText value="Nome.: "/>
		            <p:inputText value="#{clienteMB.pessoa.nome}" id="nome" styleClass="elemento-form-input largura250"/>
	
		            <h:outputText value="CPF.: "/>
		            <p:inputMask value="#{clienteMB.pessoa.cpf}" id="cpf" styleClass="elemento-form-input largura80" mask="99999999999"/>
	
		            <h:outputText value="CNPJ.:"/>
		            <p:inputMask value="#{clienteMB.pessoa.cnpj}" id="cnpj" styleClass="elemento-form-input largura100" mask="99999999999999" />
	
		            <h:outputText value="Nascimento.: "/>
		            <p:inputMask value="#{clienteMB.pessoa.dataNascimento}" id="data-nascimento" styleClass="elemento-form-input largura65" mask="99/99/9999" />
		            
		            <h:outputText value="Sexo.: "/>
		            <p:selectOneMenu value="#{clienteMB.pessoa.sexo}" id="sexo" styleClass="elemento-form-input">
		            	<f:selectItems  value="#{clienteMB.sexo}" var="sexo" itemLabel="#{sexo.toString()}" itemValue="#{sexo}"/>
		            </p:selectOneMenu>
		            
		            <h:outputText value="Data Cadastro.: "/>
		            <p:inputText value="#{clienteMB.pessoa.dataCadastro}" id="data-cadastro" disabled="true" styleClass="elemento-form-input largura65" />
		            
		            <p:growl id="mensagens"/>
	
		        </h:panelGrid>		        
		    </p:tab>
		    
		    <!-- ABA DE DADOS DO ENDEREÇO -->
		    <p:tab id="tab-enderecos" title="Endereço">
		    	<p:panel id="form-novo-endereco">
					<table id="tabela-form-endereco">
						<tr>
							<td>Rua</td><td>Número</td><td>Bairro</td><td>CEP</td><td>Cidade</td><td>UF</td><td></td>
						</tr>
						<tr>
							<td><p:inputText id="rua" value="#{clienteMB.endereco.rua}" styleClass="largura250 maiusculo"/></td>
							<td><p:inputText id="numero" value="#{clienteMB.endereco.numero}" styleClass="largura40"/></td>
							<td><p:inputText id="bairro" value="#{clienteMB.endereco.bairro}" styleClass="largura180 maiusculo"/></td>
							<td><p:inputMask id="cep" value="#{clienteMB.endereco.cep}" styleClass="largura65" mask="99999999" /></td>
							<td><p:inputText id="cidade" value="#{clienteMB.endereco.cidade}" styleClass="largura150 maiusculo"/></td>
							<td>
					            <p:selectOneMenu value="#{clienteMB.idUfSelecionada}" id="uf" style="margin: 0 0 -8px 0;">
					            	<f:selectItem itemLabel="Selecione" />
					            	<f:selectItems  value="#{clienteMB.carregaUfs()}" var="uf" itemLabel="#{uf.sigla}" itemValue="#{uf.id}"/>
					            </p:selectOneMenu>							
							</td>
							<td>
								<p:commandButton id="add-endereco" value="Adicionar" icon="ui-icon-check"
								                 actionListener="#{clienteMB.adicionarEndereco}"
												 ajax="true" update="form-novo-endereco" />
							</td>
						</tr>
					</table>
					<br />
					<p:dataTable var="endereco_incluir" value="#{clienteMB.enderecos}" styleClass="lista-enderecos-inclusos"
					             rendered="#{not empty clienteMB.enderecos}" style="width: 900px;">
						<f:facet name="header">
							<h:outputText value="Relação de Endereços inclusos" />
						</f:facet>
						<p:column headerText="Rua">
							<h:outputText value="#{endereco_incluir.rua}" />
						</p:column>
						<p:column headerText="Número" style="width: 40px;">
							<h:outputText value="#{endereco_incluir.numero}" />
						</p:column>
						<p:column headerText="Bairro" style="width: 150px;">
							<h:outputText value="#{endereco_incluir.bairro}" />
						</p:column>
						<p:column headerText="CEP" style="width: 50px;">
							<h:outputText value="#{endereco_incluir.cep}"/>
						</p:column>
						<p:column headerText="Cidade" style="width: 150px;">
							<h:outputText value="#{endereco_incluir.cidade}" />
						</p:column>				
					</p:dataTable>				
				</p:panel>
		    	<br />
		    	
		    	<!-- RELAÇÃO DE ENDEREÇOS CADASTRADOS -->
		        <h:panelGrid id="grid-enderecos">
		        	<p:dataTable id="enderecos" var="endereco" value="#{clienteMB.pessoa.enderecos}"
		        	             emptyMessage="Nenhum endereço cadastrado" editable="true" style="width: 100%;">
		        	
		        		<p:ajax event="rowEdit" listener="#{clienteMB.editarEndereco}" update=":form-geral:tab:mensagens" /> 
		        		
		        		<p:column headerText="Rua">
		        			<p:cellEditor>
		        				<f:facet name="output">
		        					<h:outputText value="#{endereco.rua}" />
		        				</f:facet>
		        				<f:facet name="input">
		        					<h:inputText value="#{endereco.rua}" />
		        				</f:facet>
		        			</p:cellEditor>
		        		</p:column>
		        		<p:column headerText="Número">
		        			<p:cellEditor>
		        				<f:facet name="output">
		        					<h:outputText value="#{endereco.numero}" />
		        				</f:facet>
		        				<f:facet name="input">
		        					<h:inputText value="#{endereco.numero}" />
		        				</f:facet>
		        			</p:cellEditor>
		        		</p:column>
		        		<p:column headerText="Bairro">
		        			<p:cellEditor>
		        				<f:facet name="output">
		        					<h:outputText value="#{endereco.bairro}" />
		        				</f:facet>
		        				<f:facet name="input">
		        					<h:inputText value="#{endereco.bairro}" />
		        				</f:facet>
		        			</p:cellEditor>
		        		</p:column>
		        		<p:column headerText="CEP">
		        			<p:cellEditor>
		        				<f:facet name="output">
		        					<h:outputText value="#{endereco.cep}" />
		        				</f:facet>
		        				<f:facet name="input">
		        					<h:inputText value="#{endereco.cep}" />
		        				</f:facet>		        				
		        			</p:cellEditor>
		        		</p:column>
		        		<p:column headerText="Cidade">
		        			<p:cellEditor>
		        				<f:facet name="output">
		        					<h:outputText value="#{endereco.cidade}" />
		        				</f:facet>
		        				<f:facet name="input">
		        					<h:inputText value="#{endereco.cidade}" />
		        				</f:facet>
		        			</p:cellEditor>
		        		</p:column>
		        		<p:column headerText="Estado">
		        			<h:outputText value="#{endereco.uf.nome}" />
		        		</p:column>
		        		<p:column headerText="UF" style="width: 50px;">
		        			<p:cellEditor>
		        				<f:facet name="output">
		        					<h:outputText value="#{endereco.uf.sigla}" />
		        				</f:facet>
		        				<f:facet name="input">
						            <p:selectOneMenu value="#{endereco.uf}" id="uf-editar"
						                             style="margin: 0 0 -1px 0; width: 80px;" immediate="true" converter="simpleIndexConverter" >
						            	<f:selectItems  value="#{clienteMB.carregaUfs()}" var="uf" itemLabel="#{uf.sigla}" itemValue="#{uf}"/>
						            </p:selectOneMenu>							
		        				</f:facet>
		        			</p:cellEditor>
		        		</p:column>		        		
		        		<p:column headerText="Operações">
		        			<p:commandLink icon="ui-icon-trash" style="border: 0; background-color: transparent;"
		        			               oncomplete="excluir.show()" rendered="#{facesContext.externalContext.isUserInRole('ROLE_ADMIN')}">
		        			    <p:spacer width="6"/>Excluir
		        				<f:setPropertyActionListener target="#{clienteMB.enderecoParaExcluir}" value="#{endereco}" />
		        			</p:commandLink>
		        			<p:rowEditor title="Alterar"/>
		        		</p:column>		        		
		        	</p:dataTable>		        
		        </h:panelGrid>
		        
		        <!-- MODAL DE CONFIRMAÇÃO DE EXCLUSÃO DE ENDEREÇO -->
				<p:confirmDialog id="modal-endereco-excluir"
				                 message="Confirma a remoção do endereço?"
				                 header="Confirmação"
				                 widgetVar="excluir"
				                 severity="alert">
				    <p:commandButton value="Sim" actionListener="#{clienteMB.excluirEndereco()}"
				    	oncomplete="excluir.hide()" update=":form-geral"/>
				    <p:commandButton value="Não" onclick="excluir.hide()"/>
				</p:confirmDialog>	        
		    </p:tab>
		    
		    <!-- ABA DE DADOS DOS CONTATOS -->		  
		    <p:tab id="tab3" title="Contatos">  
				<h1>Fncionalidade não implementada.</h1>
		    </p:tab>		  
		</p:tabView>
		
		<br />	
		<p:commandButton value="Gravar" icon="ui-icon-disk" actionListener="#{clienteMB.gravar}" update=":form-geral" />
		<p:commandButton value="Novo" icon="ui-icon-circle-plus" actionListener="#{clienteMB.criarNovo}" update=":form-geral" />
		<br />
		<br />
		
		<!-- LISTAGEM DOS CLIENTES CADASTRADOS NA BASE DE DADOS -->
		<p:dataTable var="pessoa" value="#{clienteMB.pessoasListagem}" emptyMessage="Nenhum registro encontrado" style="width: 100%;"
		   paginator="true" rows="10"
		   paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
		   rowKey="#{pessoa}" selection="#{clienteMB.pessoaSelecionada}" selectionMode="single" paginatorPosition="bottom"
		   rowsPerPageTemplate="5,10,15,20,25,30,40,50">
			<p:ajax event="rowSelect" listener="#{clienteMB.prepararEdicao()}" update=":form-geral" />
							
			<p:column headerText="Nome" width="150">
				<h:outputText value="#{pessoa.nome}" />
			</p:column>  				
			<p:column headerText="CPF">
				<h:outputText value="#{pessoa.cpf}" />
			</p:column>				
			<p:column headerText="CNPJ">
				<h:outputText value="#{pessoa.cnpj}" />
			</p:column>				
			<p:column headerText="Sexo">
				<h:outputText value="#{pessoa.sexo}" />
			</p:column>				
			<p:column headerText="Nascimento">
				<h:outputText value="#{pessoa.dataNascimento}" />
			</p:column>				
			<p:column headerText="Data Cadastro">
				<h:outputText value="#{pessoa.dataCadastro}" />
			</p:column>								
		</p:dataTable>
    </h:form>
  </ui:define>
</ui:composition>